{"version":3,"sources":["main.js"],"names":["findCharacters","element","end","selectionStart","text","value","start","i","t","SKIP","indexOf","substr","replaceCharacters","tokens","map","token","join","substring","skey_lexer","characters","pos","length","match","token_exprs","token_expr","pattern","tag","test","push","skey_eval","processOneKeyAccentedLetter","accentize","ONE_KEY_ACCENTED_LETTER","ONE_KEY_ACCENT_EXCEPTION","toUpperCase","ONE_KEY_ACCENT_DICT","VOWEL","firstVowel","secondVowel","thirdVowel","lastConsonant","accent","highPriorityVowel","VOWEL_PREFERENCES","console","log","CONSONANT","ACCENT_KEY","finallizeAccentCharacters","splice","vowel","found","ACCENT_DICT","isLocalhost","Boolean","window","location","hostname","navigator","protocol","serviceWorker","register","then","registration","onupdatefound","controller","installingWorker","installing","onstatechange","state","Error","e","error","onTextBoxChange","a1","a2","a3","a4","a5","ă1","ă2","ă3","ă4","ă5","â1","â2","â3","â4","â5","e1","e2","e3","e4","e5","ê1","ê2","ê3","ê4","ê5","i1","i2","i3","i4","i5","o1","o2","o3","o4","o5","ơ1","ơ2","ơ3","ơ4","ơ5","ô1","ô2","ô3","ô4","ô5","u1","u2","u3","u4","u5","ư1","ư2","ư3","ư4","ư5","6","7","8","9","[","]","z","d"],"mappings":"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","file":"main.min.js","sourcesContent":["/*!\n *\n *  Web Starter Kit\n *  Copyright 2015 Google Inc. All rights reserved.\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *    https://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License\n *\n */\n/* eslint-env browser */\n\n\n\n(function() {\n  'use strict';\n\n  // Check to make sure service workers are supported in the current browser,\n  // and that the current page is accessed from a secure origin. Using a\n  // service worker from an insecure origin will trigger JS console errors. See\n  // http://www.chromium.org/Home/chromium-security/prefer-secure-origins-for-powerful-new-features\n  var isLocalhost = Boolean(window.location.hostname === 'localhost' ||\n      // [::1] is the IPv6 localhost address.\n      window.location.hostname === '[::1]' ||\n      // 127.0.0.1/8 is considered localhost for IPv4.\n      window.location.hostname.match(\n        /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n      )\n    );\n\n  if ('serviceWorker' in navigator &&\n      (window.location.protocol === 'https:' || isLocalhost)) {\n    navigator.serviceWorker.register('service-worker.js')\n    .then(function(registration) {\n      // updatefound is fired if service-worker.js changes.\n      registration.onupdatefound = function() {\n        // updatefound is also fired the very first time the SW is installed,\n        // and there's no need to prompt for a reload at that point.\n        // So check here to see if the page is already controlled,\n        // i.e. whether there's an existing service worker.\n        if (navigator.serviceWorker.controller) {\n          // The updatefound event implies that registration.installing is set:\n          // https://slightlyoff.github.io/ServiceWorker/spec/service_worker/index.html#service-worker-container-updatefound-event\n          var installingWorker = registration.installing;\n\n          installingWorker.onstatechange = function() {\n            switch (installingWorker.state) {\n              case 'installed':\n                // At this point, the old content will have been purged and the\n                // fresh content will have been added to the cache.\n                // It's the perfect time to display a \"New content is\n                // available; please refresh.\" message in the page's interface.\n                break;\n\n              case 'redundant':\n                throw new Error('The installing ' +\n                                'service worker became redundant.');\n\n              default:\n                // Ignore\n            }\n          };\n        }\n      };\n    }).catch(function(e) {\n      console.error('Error during service worker registration:', e);\n    });\n  }\n\n  // Your custom JavaScript goes here\n\n  //region HELPER\n  window.onTextBoxChange = function onTextBoxChange(element) {\n    const characters = findCharacters(element);\n\n    var tokens = skey_lexer(characters[2]);\n\n    if (tokens.length > 0) {\n      tokens = skey_eval(tokens);\n      // console.log(\"tokens\", tokens);\n      replaceCharacters(element, tokens, characters[0], characters[1]);\n    }\n  }\n\n  const SKIP = \" \\n\\t\";\n\n  function findCharacters(element) {\n\n    const end = element.selectionStart;\n    var text = element.value;\n    // console.log('text', text);\n\n    var start = 0;\n\n    for(var i = end; i >= 0; i--) {\n      var t = text[i];\n      if (SKIP.indexOf(t) !== -1) {\n        start=i + 1;\n        break;\n      }\n    }\n\n    // console.log(\"WORD (\" + start + \", \" + end + \")\" + text.substr(start, end-start));\n\n    return [start, end, text.substr(start, end-start)];\n  }\n\n  function replaceCharacters(element, tokens, start, end) {\n    const text = tokens.map(function (token) {return token[0];}).join(\"\");\n    // console.log(\" - Final text to be replaced\", text);\n\n    element.value = element.value.substring(0, start) + text + element.value.substring(end);\n  }\n  //endregion\n\n\n  //region S-key engine\n  const ONE_KEY_ACCENTED_LETTER = 'ONE_KEY_ACCENTED_LETTER';\n  const ACCENT_KEY = 'ACCENT_KEY';\n  const VOWEL = 'VOWEL';\n  const CONSONANT = 'CONSONANT';\n\n  const token_exprs = [\n    [/[ \\n\\t]+/, null],\n    [/[1-5]+/, ACCENT_KEY],\n    [/[zd6-9\\[\\]]/, ONE_KEY_ACCENTED_LETTER],\n    [/[^AEIOUÁÀẢÃẠĂẮẰẲẴẶÂẦẨẪẬEÉÈẺẼẸÊẾỀỂỄỆÍÌỈĨỊÓÒỎÕỌƠỚỜỞỠỢÔỐỒỔỖỘÚÙỦŨỤƯỨỪỬỮỰ6-9]+/i, CONSONANT],\n    [/[AEIOUÁÀẢÃẠĂẮẰẲẴẶÂẦẨẪẬEÉÈẺẼẸÊẾỀỂỄỆÍÌỈĨỊÓÒỎÕỌƠỚỜỞỠỢÔỐỒỔỖỘÚÙỦŨỤƯỨỪỬỮỰ]+/i, VOWEL]\n  ];\n\n  const VOWEL_PREFERENCES = \"EÉÈẺẼẸÊẾỀỂỄỆOÓÒỎÕỌƠỚỜỞỠỢÔỐỒỔỖỘ\";\n\n  const ACCENT_DICT = {\n    \"a1\": \"á\",\n    \"a2\": \"à\",\n    \"a3\": \"ả\",\n    \"a4\": \"ã\",\n    \"a5\": \"ạ\",\n\n    \"ă1\": \"ắ\",\n    \"ă2\": \"ằ\",\n    \"ă3\": \"ẳ\",\n    \"ă4\": \"ẵ\",\n    \"ă5\": \"ặ\",\n\n    \"â1\": \"ấ\",\n    \"â2\": \"ầ\",\n    \"â3\": \"ẩ\",\n    \"â4\": \"ẫ\",\n    \"â5\": \"ậ\",\n\n    \"e1\": \"é\",\n    \"e2\": \"è\",\n    \"e3\": \"ẻ\",\n    \"e4\": \"ẽ\",\n    \"e5\": \"ẹ\",\n\n    \"ê1\": \"ế\",\n    \"ê2\": \"ề\",\n    \"ê3\": \"ể\",\n    \"ê4\": \"ễ\",\n    \"ê5\": \"ệ\",\n\n    \"i1\": \"í\",\n    \"i2\": \"ì\",\n    \"i3\": \"ỉ\",\n    \"i4\": \"ĩ\",\n    \"i5\": \"ị\",\n\n    \"o1\": \"ó\",\n    \"o2\": \"ò\",\n    \"o3\": \"ỏ\",\n    \"o4\": \"õ\",\n    \"o5\": \"ọ\",\n\n    \"ơ1\": \"ớ\",\n    \"ơ2\": \"ờ\",\n    \"ơ3\": \"ở\",\n    \"ơ4\": \"ỡ\",\n    \"ơ5\": \"ợ\",\n\n    \"ô1\": \"ố\",\n    \"ô2\": \"ồ\",\n    \"ô3\": \"ổ\",\n    \"ô4\": \"ỗ\",\n    \"ô5\": \"ộ\",\n\n    \"u1\": \"ú\",\n    \"u2\": \"ù\",\n    \"u3\": \"ủ\",\n    \"u4\": \"ũ\",\n    \"u5\": \"ụ\",\n\n    \"ư1\": \"ứ\",\n    \"ư2\": \"ừ\",\n    \"ư3\": \"ử\",\n    \"ư4\": \"ữ\",\n    \"ư5\": \"ự\"\n  };\n\n  const ONE_KEY_ACCENT_DICT = {\n    \"6\": \"â\",\n    \"7\": \"ê\",\n    \"8\": \"ô\",\n    \"9\": \"ă\",\n    \"[\": \"ư\",\n    \"]\": \"ơ\",\n    \"z\": \"d\",\n    \"d\": \"đ\"\n  };\n\n  const ONE_KEY_ACCENT_EXCEPTION = \"D\";\n\n  function skey_lexer(characters) {\n    var pos = 0;\n    var tokens = [];\n\n    while(pos < characters.length) {\n      var match = null;\n      for(var i = 0; i < token_exprs.length; i++) {\n        const token_expr = token_exprs[i];\n        const pattern = token_expr[0];\n        const tag = token_expr[1];\n        const text = characters[pos];\n\n        // console.log(\"pattern\", pattern);\n\n        match = pattern.test(text);\n\n        if (match) {\n          if (tag) {\n            const token = [text, tag];\n            tokens.push(token);\n          }\n          break;\n        }\n      }\n\n      if (!match) {\n        // console.log(\"error\")\n      }\n      else {\n        pos = pos + 1;\n      }\n    }\n\n    return tokens;\n\n  }\n\n  function skey_eval(tokens) {\n    // console.log(\"START OF skey_eval()\");\n\n    tokens = processOneKeyAccentedLetter(tokens);\n    // console.log('after one key accented letter: ', tokens);\n\n    tokens = accentize(tokens);\n    // console.log(\"token after first accentize\", tokens);\n\n    return tokens;\n  }\n\n  // dó\n  // zó\n\n  function processOneKeyAccentedLetter(tokens) {\n    for(var i = 0; i < tokens.length; i++) {\n      const token = tokens[i];\n\n      if (token[1] === ONE_KEY_ACCENTED_LETTER) {\n        if (tokens.length > 1 && ONE_KEY_ACCENT_EXCEPTION.indexOf(token[0].toUpperCase()) !== -1) {\n          continue;\n        }\n\n        token[0] = ONE_KEY_ACCENT_DICT[token[0]];\n        token[1] = VOWEL;\n        break;\n      }\n    }\n    return tokens;\n  }\n\n  function accentize(tokens) {\n    var firstVowel, secondVowel, thirdVowel, lastConsonant, accent, highPriorityVowel;\n    for(var i = 0; i < tokens.length; i++) {\n      const token = tokens[i];\n\n      // console.log(\" - Considering token: \", token);\n\n      if (token[1] === VOWEL) {\n        if (VOWEL_PREFERENCES.indexOf(token[0].toUpperCase()) !== -1) {\n          console.log(\" - Found a higher priority vowel\", token);\n          highPriorityVowel = [i, token];\n        }\n        thirdVowel = secondVowel ? [i, token] : thirdVowel;\n        secondVowel = firstVowel ? [i, token] : secondVowel;\n        firstVowel = firstVowel ? firstVowel : [i, token];\n      }\n      else if (token[1] === CONSONANT) {\n        lastConsonant = (firstVowel || secondVowel || thirdVowel) ? [i, token] : lastConsonant;\n      }\n      else if (token[1] === ACCENT_KEY) {\n        accent = [i, token];\n      }\n\n      console.log(\" - first vowel\", firstVowel);\n      console.log(\" - second vowel\", secondVowel);\n      console.log(\" - third vowel\", thirdVowel);\n      console.log(\" - last consonant\", lastConsonant);\n      console.log(\" - accent\", accent);\n\n      if (highPriorityVowel && accent && !secondVowel) {\n        if (finallizeAccentCharacters(highPriorityVowel[1], accent[1])) {\n          tokens.splice(accent[0], 1);\n        }\n      }\n      else if (thirdVowel && accent) {\n        if (finallizeAccentCharacters(secondVowel[1], accent[1])) {\n          tokens.splice(accent[0], 1);\n        }\n      }\n      else if (secondVowel && lastConsonant && accent) {\n        if (finallizeAccentCharacters(secondVowel[1], accent[1])) {\n          tokens.splice(accent[0], 1);\n        }\n      }\n      else if (secondVowel && accent) {\n        if (finallizeAccentCharacters(firstVowel[1], accent[1])) {\n          tokens.splice(accent[0], 1);\n        }\n      }\n\n      else if (firstVowel && accent) {\n        if (finallizeAccentCharacters(firstVowel[1], accent[1])) {\n          tokens.splice(accent[0], 1);\n        }\n      }\n    }\n\n    return tokens;\n\n  }\n\n\n  function finallizeAccentCharacters(vowel, accent) {\n    const found = ACCENT_DICT[vowel[0] + accent[0]];\n\n    if (found) {\n      vowel[0] = found;\n      return true;\n    }\n    return false;\n  }\n  //endregion\n\n})();\n"]}